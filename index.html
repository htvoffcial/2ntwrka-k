
<html>
  <head>
    <!--メタ情報　及び　外部スクリプト読み込み-->
    <!--(c) 2022 はるはる-->
    <meta charset="utf-8" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0">
   <meta property="og:title" content="喜びを共有するプロジェクト">
<meta property="og:url" content="https://moonlit-bonbon-7751df.netlify.app/%E5%96%9C%E3%81%B3">
<meta property="og:description" content="喜びを分かち合う">
<meta property="og:type" content="website">
<meta property="og:image" content="https://moonlit-bonbon-7751df.netlify.app/%E5%96%9C%E3%81%B3/ogp.png">
    <!--メタ情報　及び　外部スクリプト読み込み of 終わり-->
  </head>
  <body>
  <topbar></topbar>
    <!--ページ内コンテンツ-->
     <div id="toppage" class="page">
　　　<!-- ページ1 -->
         <center><img src="content1.gif" id="logo"><br>

            <div id="todayresult">
            </div>
         <share onclick="push()"></share>
        </center>
         <center><bmg>&copy;2023 3-2 /<a href="info.html#all">このサイトの詳細</a><br>※数値はリアルタイムではない可能性があります</bmg></center>
     </div>
 <div id="tmp"></div>
     <div id="spop">
      <p id="dp"></p>
     </div>
     <script>
var userd1;

$(document).ready(function() {
  $.ajax({
    url: "https://script.google.com/macros/s/AKfycbwKiXHATrxOrYLQWPct4AIYqeFDcMO9ihhHIx5jeUOs2TZMsQGpHT_5dD8q-9o2Rzdh/exec",
    method: "POST",
    data: {
      action: "getUserData",
      username: "admin" // ログインしたユーザーのユーザー名を設定
    },
    success: function(response) {
      userd1 = JSON.parse(response);
      localStorage.setItem("pushon", userd1[3]);
      if (localStorage.getItem("pushon") || localStorage.getItem("pushlo")) {
        var pussh = localStorage.getItem("pushon");
        var crt = localStorage.getItem("pushlo");
        document.getElementById("todayresult").innerHTML = "<span style='font-size:100px;font-weight:bold;'>" + crt + "</span><span style='font-size:50px;'>/25回</span><br><span style='font-size:30px;font-weight:bold;'>これまでの合計(アカウント連携):" + pussh + "</span>";
      } else {
        var pussh = 0;
        localStorage.setItem("pushon", pussh);
        var crt = 0;
        localStorage.setItem("pushlo", crt);
      };
    },
    error: function() {
      alert("ユーザーデータの取得中にエラーが発生しました。");
    }
  });
});

function resetLocalStorage() {
  const today = new Date().toLocaleDateString(); // 現在の日付を取得
  const pushsuiiData = localStorage.getItem("pushsuii"); // ローカルストレージからデータを取得

  if (pushsuiiData) {
    const { date, count } = JSON.parse(pushsuiiData);
    if (date !== today) {
      localStorage.removeItem("pushon");
      localStorage.setItem("pushsuii", JSON.stringify({ date: today, count: 0 }));
    }
  } else {
    localStorage.setItem("pushsuii", JSON.stringify({ date: today, count: 0 }));
  }
}

var fflag = 0;

function push() {
  let crt = parseInt(localStorage.getItem("pushlo") || 0) + 1;
  localStorage.setItem("pushlo", crt);
  let pussh = parseInt(localStorage.getItem("pushon") || 0);
  document.getElementById("todayresult").innerHTML = "<span style='font-size:100px;font-weight:bold;'>" + crt + "</span><span style='font-size:50px;'>/25回</span><br><span style='font-size:30px;font-weight:bold;'>これまでの合計(アカウント連携):" + pussh + "</span>";
  resetLocalStorage(); // 日付が変わった場合の処理
  gchg();
}

function gchg() {
  var currentDate = new Date();
  fflag++;
  if (fflag == 3) {
    var aar = [...userd1];
    aar[3] = parseInt(aar[3]) + parseInt(localStorage.getItem("pushlo"));
    console.log(aar);
    $.post("https://script.google.com/macros/s/AKfycbwKiXHATrxOrYLQWPct4AIYqeFDcMO9ihhHIx5jeUOs2TZMsQGpHT_5dD8q-9o2Rzdh/exec", { action: "updateUserData", username: "admin", newData: JSON.stringify(aar) });

    fflag = 0;
  }
}

    </script>
    <style>
      #todayresult{
        margin-top: 50px;
        color:#21A0DB;
      }
     close:after{
       display:inline-block;
       color:#fff;
       position:absolute;
       bottom:20px;
       font-weight:bold;
       content:"閉じる";
       padding:4 15 4 15;
       background-color:#21A0DB;
       text-align:center;
       margin-top:2vw;
       border-radius:10px;
      }
     #dp{
       margin-top:2vw;
       margin-left:2vw;
     }
     report:after{
      content:"問題のあるユーザーを報告する🚨";
      margin-left:2vw;
      cursor:pointer;
      font-weight:bold;
      font-size:10px;
     }
     #spop{
       position:absolute;
       bottom:0;
       left:0px;
       z-index:1000;
       border-radius:20px 20px 0px 0px;
       background:#e0e0e0;
       width:100%;
       height: 0%;
     }
    .pp{
      display:block;
      animation:popup 0.3s ease-out forwards;
     }
     bmg{
      display:block;
      width:100%;
      position:absolute;
      bottom:10px;
      color:#a1a3a6;
     }
     #logo{
        width:230px;
       margin-top:5vw;
     }
     #sharepage{
      width:100%;
      display:none;
      height:calc(100% - 60px);
     }
      share:after{
       display:inline-block;
       margin-top:2vw;
       content:"ありがとう!";
       color:#fff;
       font-weight:bold;
       padding:5vw 2.7vw 5vw 2.7vw;
       background-color:#21A0DB;
       border-radius:50%;
      }
      #toppage{
        width:100%;
        height:calc(100% - 60px);
      }
      a{
       text-decoration:none;
       margin-left:5px;
      }
      .page{
        position:absolute;
        top:56px;
        left:0px;
      }
      topbar:after{
        content:"ありがとう3000回プロジェクト";
      }
      topbar {
        display: block;
        position: absolute;
        top: 0;
        left: 0;
        background-color: #ffcccc;
        padding: 16px 0px 16px 30px;
        width: calc(100% - 30px);
        color: #fff;
      }
     @keyframes popup {
        0% {
        bottom: 0%;
       }
       100% {
        bottom: 0%;
        height: 20%;
       }
     }
     @media screen and (max-width: 480px) {
       #logo{
       margin-top:20vw;
       }
      share:after{
       display:inline-block;
       margin-top:30vw;
       content:"ありがとう";
       color:#fff;
       font-weight:bold;
       padding:16vw 15vw 160vw 15vw;
       background-color:#21A0DB;
       border-radius:50%;
      }
     }
     
    </style>
    <!--ページ内コンテンツ of 終わり-->
  </body>
</html>
